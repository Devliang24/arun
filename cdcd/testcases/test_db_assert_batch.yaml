config:
  name: 批量 SQL 断言示例（多变量/单变量列表/索引切片）
  base_url: ${ENV(BASE_URL)}
  tags: [demo, db, batch]
  variables:
    # 演示用用户 ID；在未配置数据库时，hooks 会回退到内存表：{1:active, 2:active, 3:blocked}
    id1: 1
    id2: 2
    id3: 3
    ids: [1, 2, 3]

steps:
  - name: 多变量（可变参数）
    # 直接传入多个变量作为入参
    variables:
      expected_statuses: ${expected_sql_values($id1, $id2, $id3, column="status")}
      body:
        ids: [$id1, $id2, $id3]
        statuses: $expected_statuses
    request:
      method: POST
      path: /anything
      body: $body
    validate:
      - eq: [status_code, 200]
      - eq: [$.json.statuses, $expected_statuses]

  - name: 单变量（列表）
    # 以一个列表变量作为入参
    variables:
      expected_statuses_list: ${expected_sql_values($ids, column="status")}
      body:
        ids: $ids
        statuses: $expected_statuses_list
    request:
      method: POST
      path: /anything
      body: $body
    validate:
      - eq: [status_code, 200]
      - eq: [$.json.statuses, $expected_statuses_list]

  - name: 混合与索引/切片（前两项）
    # 传入切片、以及混合单个索引
    variables:
      expected_head2: ${expected_sql_values($ids[:2], column="status")}
      # 演示混合：第1和第3个
      expected_1_and_3: ${expected_sql_values($ids[0], $ids[2], column="status")}
    request:
      method: POST
      path: /anything
      body:
        head2: $expected_head2
        one_and_three: $expected_1_and_3
    validate:
      - eq: [status_code, 200]
      - eq: [$.json.head2, $expected_head2]
      - eq: [$.json.one_and_three, $expected_1_and_3]

config:
  name: Update Current User Profile
  base_url: "${ENV(BASE_URL)}"
  variables:
    new_full_name: "User ${uuid4()}"
    new_address: "No.9 Automation Rd"
  tags: [users]
steps:
  - name: login
    request:
      method: POST
      url: /api/v1/auth/login
      json:
        username: "${ENV(USER_USERNAME)}"
        password: "${ENV(USER_PASSWORD)}"
    extract:
      token: $.data.access_token
    validate:
      - [status_code, eq, 200]

  - name: update me
    variables:
      authz: "Bearer ${token}"
    request:
      method: PUT
      url: /api/v1/users/me
      headers:
        Authorization: "${authz}"
      json:
        full_name: "${new_full_name}"
        shipping_address: "${new_address}"
    validate:
      - [status_code, eq, 200]

  - name: get me
    variables:
      authz: "Bearer ${token}"
    request:
      method: GET
      url: /api/v1/users/me
      headers:
        Authorization: "${authz}"
    validate:
      - [status_code, eq, 200]
      - [$.data.shipping_address, contains, "${new_address}"]

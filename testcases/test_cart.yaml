config:
  name: Cart Operations
  base_url: "${ENV(BASE_URL)}"
  tags: [cart]
steps:
  - name: login
    request:
      method: POST
      url: /api/v1/auth/login
      json:
        username: "${ENV(USER_USERNAME)}"
        password: "${ENV(USER_PASSWORD)}"
    extract:
      token: body.access_token
    validate:
      - [status_code, eq, 200]

  - name: get product
    request:
      method: GET
      url: /api/v1/products/
    extract:
      product_id: body.items[0].id
    validate:
      - [status_code, eq, 200]

  - name: add to cart
    variables:
      authz: "Bearer ${token}"
    request:
      method: POST
      url: /api/v1/cart/items
      headers:
        Authorization: "${authz}"
      json:
        product_id: "${product_id}"
        quantity: 2
    validate:
      - [status_code, eq, 201]

  - name: update quantity
    variables:
      authz: "Bearer ${token}"
    request:
      method: PUT
      url: /api/v1/cart/items/${product_id}
      headers:
        Authorization: "${authz}"
      json:
        quantity: 1
    validate:
      - [status_code, eq, 200]

  - name: get cart
    variables:
      authz: "Bearer ${token}"
    request:
      method: GET
      url: /api/v1/cart/
      headers:
        Authorization: "${authz}"
    validate:
      - [status_code, eq, 200]

  - name: remove from cart
    variables:
      authz: "Bearer ${token}"
    request:
      method: DELETE
      url: /api/v1/cart/items/${product_id}
      headers:
        Authorization: "${authz}"
    validate:
      - [status_code, eq, 200]

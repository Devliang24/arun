config:
  name: "Example: SQL Validate"
  base_url: ${ENV(BASE_URL)}
  # 可在环境中通过 MYSQL_* 或 MYSQL_DSN 提供数据库连接
steps:
  - name: create order (demo)
    request:
      method: POST
      url: /api/v1/orders/
      json:
        shipping_address: "No.9 Demo Road"
    extract:
      order_id: $.data.order_id
      order_total: $.data.total_price
    validate:
      - in: [status_code, [200, 201]]
    sql_validate:
      - query: "SELECT status, total_amount FROM orders WHERE id='$order_id'"
        expect:
          - eq: [status, pending]
          - eq: [total_amount, var:order_total]
        allow_empty: false
      - query: "SELECT COUNT(*) AS cnt FROM order_items WHERE order_id='$order_id'"
        expect:
          - ge: [cnt, 1]
        allow_empty: false

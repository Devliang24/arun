config:
  name: "SQL DSN 覆盖"
  base_url: ${ENV(BASE_URL)}
  variables:
    mysql_dsn: ${ENV(MYSQL_DSN)}
steps:
  - name: 创建订单（无 DSN 跳过）
    skip: ${not $mysql_dsn}
    request:
      method: POST
      url: /api/v1/orders/
      body:
        shipping_address: "No.3 Demo Road"
    extract:
      order_id: $.data.order_id

  - name: 使用覆盖 DSN 查询
    skip: ${not $mysql_dsn}
    request:
      method: GET
      url: /
    sql_validate:
      - query: "SELECT COUNT(*) AS cnt FROM order_items WHERE order_id='$order_id'"
        dsn: $mysql_dsn
        expect:
          - ge: [cnt, 1]

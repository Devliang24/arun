config:
  name: 多用例目录-认证流程
  base_url: ${ENV(BASE_URL)}
  tags: [auth, temp]
  variables:
    username: u_${short_uid(10)}
    email: u_${uid()}@example.com
    password: Pwd_${short_uid(8)}

steps:
  - name: 注册
    request:
      method: POST
      url: /api/v1/auth/register
      headers:
        Content-Type: application/json
      body:
        username: $username
        email: $email
        password: $password
        full_name: Temp User
    extract:
      username: $.data.username
    validate:
      - in: [status_code, [200, 201]]
      - eq: [$.success, true]

  - name: 登录
    request:
      method: POST
      url: /api/v1/auth/login
      headers:
        Content-Type: application/json
      body:
        username: $username
        password: $password
    extract:
      token: $.data.access_token
    validate:
      - eq: [status_code, 200]
      - eq: [$.success, true]

  - name: 我是谁
    request:
      method: GET
      url: /api/v1/users/me
      headers:
        Authorization: Bearer $token
    validate:
      - eq: [status_code, 200]
      - eq: [$.success, true]

